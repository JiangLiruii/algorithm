# 哈希算法(上) -- 如何防止数据库中的用户信息被脱库?

## 脱库就是数据从数据库中被窃取, 并且破解了信息加密以明文的形式公开或利用的概念. 那么在储存数据的时候究竟应该使用什么样的加密方式可以让用户的信息更好的保存呢?

## 哈希算法不是指某一种算法, 而是指组成散列表的哈希函数, 著名的哈希算法有很多, MD5, SHA, RSA等, 平时的开发中基本上是拿来即用. 

## 哈希算法可以将任意长度的二进制值串映射成固定长度的二进制值串, 通过映射后的值即为哈希值, 要设计这个方法需要以下的特点
- 不能从哈希值反向推导出原始数据, 必须是单向的
- 对输入数据非常敏感, 哪怕数据只相差一个字节哈希值也会有很大的不同
- 散列冲突的概率要小 -- 对不同的原始数据, 哈希值相同的概率要非常的小
- 哈希算法的执行效率要尽量高效, 针对较长的文本也能在较短时间内进行哈希化

## 哈希算法的应用:
- 1 安全加密: 最常用的加密算法是MD5(MD5 Message-Digest Algorithm) 和 SHA(Secure Hash Algorithm), 其余还有DES(Data Encryption Standard 数据加密标准), AES(Advanced Encryption Standard, 高级加密标准)
### 对于加密的算法有两点非常的重要
- 很难根据哈希值推到原始数据
- 散列冲突概率要小

### 第一点很好理解, 是加密的基本需求, 第二点为什么是概率要小而不是没有呢? 因为根据鸽巢(抽屉)原理, 如果有10个鸽巢, 要放11个鸽子, 那么必然会有一个鸽巢里面放的是至少两个鸽子.所以不管什么hash算法都不能导致不冲突, 只能减少冲突, 比如MD5, 哈希值是一个128位的二进制串, 能表示的数据是有限的也就是2的128次方,如果要加密2的128次方+1个数据, 那么必然会有2个数据对应的是同一个hash值.

### 不过即使hash算法有冲突的可能性, 但是概率实在很低, 1/2^128, 是一个很小的数,

### 除此之外, 没有绝对的安全, 但是有相对的, 比如SHA-256就比SHA-1要安全得多.需要计算的时间越长, 算法就越安全

- 2 唯一标识

### 举一个例子, 如何在海量的图片库里找到对应的图片?如果对数据库中每个图片的二进制文件进行一一比对, 是可以完成该功能, 但是消耗的时间和cpu资源是比较昂贵的. 这个时候可以考虑hash表, 通过hash算法将每张图片对应成一个hash值, 然后每次查找的时候从hash表中查找即可, 更保险的避免冲突的情况是拿到数据再行二进制文件的比对, 消耗的时间会少很多.

- 3 数据校验

### 在类似电驴的p2p下载工具中, 一个文件的下载是通过多个用户的点对点下载完成的, 如果有任意一个用户篡改了下载数据, 植入了恶意代码, 那么就会对下载的安全性造成威胁, 所以如何校验下载的数据是否是没有经过修改的原始数据呢?这里就可以使用hash算法对分成的每一块数据求得哈希值, 每一块下载完成之后便进行校验是否与原hash值一样, 如果不一样, 则尝试另一个用户进行下载. 

- 4 散列函数

### 散列函数就没以上应用那么严格和复杂了, 只需要满足低概率冲突, hash后的值均匀分布就即可, 对于是否能反推原始数据没有要求. 但是对散列函数的执行效率有要求, 不能过于复杂.

## 通过以上的方法就可以解答最开始的如何防止脱库的问题了, 使用SHA或RSA加密算法, 对用户信息进行加密. 当然黑客还可以使用撞库的方式, 因为用户设置的密码如果很简单, 比如12345, 可以通过字典值hash化之后进行比对. 如果hash值一致, 基本上(因为还是有极低概率的冲突)可以判断该字典值就是加密前的明文了.这个时候就需要对算法加一点盐(salt), 跟用户的密码混在一起. 不过, 也没有绝对的安全, 这些措施也只是增加了破解的难度, 只要有足够算力的计算机, 都是可以破解的.
# 现在很火的区块链也是跟hash算法有千丝万缕的联系哦~