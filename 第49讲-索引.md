如何在海量的数据中快速查找某个数据?

为什么需要索引?

实际软件开发真有很多千变万化的业务, 但是抛开业务和功能, 剩下的本质就是对数据的储存和计算. 储存就是数据结构, 计算就是算法. 

储存的需求无外乎增删改查, 但是储存的数据量很大的话性能就会成为瓶颈, 特别是跟储存相关的基础系统, 比如MySQL数据库, 分布式文件系统, 和中间件, 比如消息中间件RocketMQ

如何节省空间的储存空间, 如何提高增删改查的执行效率?就成了设计的重点.而这些设计都离不开索引. 索引设计的好坏直接决定了系统是否优秀.

系统设计需求可以从功能性需求和非功能性需求来分析

### 1. 功能性需求

**数据是格式化数据还是非格式化数据**

1. 格式化数据: MySQL中的数据
2. 非结构化数据: 搜索引擎中的网页, 需要进行数据清洗(预处理), 提取出查询关键词, 对关键词构建索引

**数据是静态还是动态的**?

1. 静态: 原始数据不会经历增加, 删除和更新操作, 在构建索引时只需要考虑查询的效率即可
2. 动态: 原始数据除了查询外还会动态更新, 所以索引也要动态更新, 这要保证查询的效率的同时, 也要保证更新索引的复杂度不能太高

**索引储存在硬盘还是内存**?

储存在硬盘的查询速度肯定比内存的速度低, 原始数据量很大也不得不为之.实际上往往会讲一部分数据储存在内存, 一部分储存在磁盘, 兼顾内存消耗和查询效率

**单值查找还是区间查找**?

单值:只需要找到关键词的一个特定的值
区间:需要查找关键词处于某个区间的所有数据

**单关键词查找还是多关键词联合查找**?

搜索引擎构建的索引就需要支持一个关键词也需要支持多个关键词联合查找, 对于多关键字, 可以先针对单关键字构建索引, 然后通过集合操作, 求并集, 交集等, 计算关键词组合的查询结果

### 2. 非功能性要求

不管是储存在内存还是磁盘中,索引对储存空间的消耗不能过大

考虑索引查询效率, 同时也要考虑索引维护成本

## 索引常用的数据结构有哪些?

支持动态数据集合的数据结构:

红黑树, 散列表, 跳表, B+树等, 位图和布隆过滤器可以作为辅助索引(不存在一定不存在, 存在不一定存在), 有序数组可以用来静态数据构建索引

散列表增删改查的性能非常好O(1), 一些键值数据库, 比如Redis, Memcache就是用散列表构建索引, 一般存在内存中

红黑树为平衡二叉树, 插入, 删除查找时间复杂度为O(logn), Ext文件系统中, 对磁盘块的索引就是用的红黑树

B+树比起红黑树更适合构建储存在磁盘中的索引, B+树是一个多叉树, 高度会低于红黑树, 所以读取B+树索引, 需要的磁盘IO次数其实不多, 所以大部分关系型数据库, MySQL, Oracle都是用B+树实现的

跳表也支持快速添加,删除,查找数据.通过灵活调整索引节点个数和数据个数的比例, 平衡索引内存消耗和查询效率, Redis的有序集合就是跳表构建的

有序数组也可以被作为索引, 如果数据是静态的, 不会有插入, 删除, 更新的话, 可以把关键词抽取出来, 组织成有序数组, 利用二分查找算法快速查找数据.